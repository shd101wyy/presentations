<!-- slide -->

# 我先问个问题

在你学习过的古诗中，请说出带 **前** 字的诗句。

<!-- slide -->

- 静夜思

床**前**明月光  
疑是地上霜  
举头望明月  
低头思故乡

<!-- slide -->

- 望庐山瀑布

日照香炉生紫烟  
遥看瀑布挂**前**川  
飞流直下三千尺  
疑是银河落九天

<!-- slide -->

明明都会背诵，但是为什么如果让你们找到含有 **前** 字的古诗，会很难说出来呢？

<!-- slide -->

# 答案

因为我们的脑子里面没有建立**倒排索引 (inverted index)**。

<!-- slide -->

# 问题

大家一般背诵古诗都是怎么背诵的呢？

<!-- slide -->

我们脑子中的索引，一般是以诗名作为 Key，诗的内容作为 Value。

例如:

```
Key                     Value

                       床前明月光
静夜思       =>         疑是地上霜
                       举头望明月
                       低头思故乡
```

所以当我让你们背诵静夜思你马上能反应过来，因为你从你的脑子中的索引直接找到了诗。

<!-- slide -->

但是我让你说出带“前”字的诗句，由于没有索引，你只能遍历脑海中所有的诗句，当你的脑海中诗词量大，就很难在短时间内得到结果。

<!-- slide -->

# 倒排索引

倒排索引又叫反向索引，举个例子  
我们以 “**前**” 字作为 Key，诗句作为 Value

```
Key                     Value

前          =>         床前明月光
                       疑是地上霜
```

<!-- slide -->

# 索引爆炸

如果每个字都用来建立倒排索引...

```
Key                     Value
床          =>         床前明月光
                       疑是地上霜

前          =>         床前明月光
                       疑是地上霜
...
上          =>         床前明月光
                       疑是地上霜

霜          =>         床前明月光
                       疑是地上霜
```

<!-- 记忆量会爆炸性增长 -->

<!-- slide -->

# 解决方案？

<!-- slide -->

我们可以依旧用诗句中的字作为 Key，但不再使用诗句作为 Value，而是使用诗名作为 Value

```
Key                     Value
床          =>          静夜思

前          =>          静夜思

...
上          =>          静夜思

霜          =>          静夜思
```

这样一来 Value 中存的东西就少了

<!-- slide -->

我们还可以将诗句中的字作为 Key，对应多个诗名作为 Value，而不仅仅是一个诗名

<br>

```
Key                     Value
前          =>          静夜思
                        望庐山瀑布
```

<br>

这样在我们想要搜索带有 **前** 字的古诗时，我们可以迅速的找到 **静夜思** 和 **望庐山瀑布** 这两首古诗，然后再从古诗的诗句中，找到含有 **前** 字的诗句

<!-- slide -->

# References

- [终于有人把 ElasticSearch 原理讲透了](https://zhuanlan.zhihu.com/p/62892586)
